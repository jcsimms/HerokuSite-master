<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Estimation Calculator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Salesforce Sans', 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(180deg, #B0D4ED 0%, #D4E8F5 50%, #E8F2F8 100%);
            color: #181818;
            line-height: 1.5;
            padding: 40px 20px;
            min-height: 100vh;
        }

        .page-title {
            text-align: center;
            font-size: 36px;
            font-weight: 700;
            color: #181818;
            margin-bottom: 32px;
            letter-spacing: -0.5px;
        }

        .modal-card {
            max-width: 1400px;
            margin: 0 auto;
            background: #F4F6F9;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            padding: 40px;
            position: relative;
        }

        .close-button {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 32px;
            height: 32px;
            border: none;
            background: transparent;
            color: #0176D3;
            font-size: 24px;
            cursor: pointer;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s ease;
        }

        .close-button:hover {
            background: rgba(1, 118, 211, 0.1);
        }

        .card-title {
            font-size: 28px;
            font-weight: 700;
            color: #181818;
            margin-bottom: 10px;
        }

        .card-description {
            font-size: 14px;
            color: #3e3e3c;
            margin-bottom: 32px;
            line-height: 1.5;
        }

        .form-group {
            margin-bottom: 24px;
        }

        .form-row {
            display: flex;
            gap: 32px;
            align-items: center;
        }

        .form-group-inline {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .question-label {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 16px;
            font-weight: 400;
            color: #3e3e3c;
            white-space: nowrap;
        }

        .question-label-large {
            font-size: 16px;
        }

        .info-icon {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #DDDBDA;
            color: #3e3e3c;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: 600;
            cursor: help;
            flex-shrink: 0;
        }

        .input-field {
            flex: 1;
            padding: 10px 14px;
            border: 1px solid #DDDBDA;
            border-radius: 6px;
            font-size: 18px;
            font-weight: 700;
            background: white;
            color: #0176D3;
            text-align: right;
            transition: all 0.2s ease;
        }

        .input-field:focus {
            outline: none;
            border-color: #0176D3;
            box-shadow: 0 0 0 3px rgba(1, 118, 211, 0.1);
        }

        /* Remove spinner buttons from number input */
        .input-field::-webkit-inner-spin-button,
        .input-field::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        .input-field[type=number] {
            -moz-appearance: textfield;
        }

        /* Stepper Button Styling */
        .stepper-container {
            display: flex;
            align-items: center;
            gap: 0;
            border: 1px solid #DDDBDA;
            border-radius: 6px;
            overflow: hidden;
            background: white;
            flex: 1;
        }

        .stepper-button {
            width: 36px;
            height: 36px;
            border: none;
            background: #F3F2F2;
            color: #3e3e3c;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            flex-shrink: 0;
        }

        .stepper-button:hover {
            background: #E5E5E5;
            color: #0176D3;
        }

        .stepper-button:active {
            background: #DDDBDA;
        }

        .stepper-input {
            flex: 1;
            text-align: center;
            height: 36px;
            border: none;
            border-left: 1px solid #DDDBDA;
            border-right: 1px solid #DDDBDA;
            font-size: 14px;
            font-weight: 600;
            background: white;
            color: #3e3e3c;
            padding: 0 8px;
        }

        /* Source Items - Single Line */
        .source-item {
            background: white;
            border: 1px solid #DDDBDA;
            border-radius: 8px;
            padding: 16px 20px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .source-item-static {
            background: white;
            border: 1px solid #DDDBDA;
            border-radius: 8px;
            padding: 16px 20px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .source-name {
            min-width: 150px;
        }

        .source-name-input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #DDDBDA;
            border-radius: 6px;
            font-size: 13px;
            background: white;
        }

        .source-name-input:focus {
            outline: none;
            border-color: #0176D3;
            box-shadow: 0 0 0 3px rgba(1, 118, 211, 0.1);
        }

        .source-name-static {
            min-width: 150px;
            font-size: 13px;
            font-weight: 600;
            color: #3e3e3c;
        }

        .source-type {
            min-width: 280px;
            display: flex;
            gap: 24px;
        }

        .source-type-static {
            min-width: 280px;
        }

        .radio-column {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .radio-column-label {
            font-size: 12px;
            font-weight: 600;
            color: #3e3e3c;
            text-align: center;
        }

        .radio-button {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: #0176D3;
        }

        .source-multiplier {
            min-width: 200px;
        }

        .source-multiplier-label {
            font-size: 12px;
            color: #706e6b;
            margin-bottom: 6px;
        }

        .source-checkbox {
            min-width: 200px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .source-checkbox input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: #0176D3;
        }

        .source-checkbox-label {
            font-size: 13px;
            color: #3e3e3c;
            cursor: pointer;
        }

        .source-result {
            flex: 1;
            text-align: right;
        }

        .source-result-input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #DDDBDA;
            border-radius: 6px;
            font-size: 18px;
            font-weight: 700;
            background: white;
            color: #0176D3;
            text-align: right;
            transition: all 0.2s ease;
        }

        .source-result-input:focus {
            outline: none;
            border-color: #0176D3;
            box-shadow: 0 0 0 3px rgba(1, 118, 211, 0.1);
        }

        .source-result-static {
            flex: 1;
            text-align: right;
            font-size: 18px;
            font-weight: 700;
            color: #0176D3;
        }

        /* Remove spinner buttons from number input */
        .source-result-input::-webkit-inner-spin-button,
        .source-result-input::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        .source-result-input[type=number] {
            -moz-appearance: textfield;
        }

        /* Button Styling */
        .action-button {
            background: #0176D3;
            color: white;
            border: none;
            padding: 10px 28px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-top: 24px;
            float: right;
            clear: both;
        }

        .action-button:hover {
            background: #005fb2;
            box-shadow: 0 2px 8px rgba(1, 118, 211, 0.3);
        }

        .action-button:active {
            background: #004d94;
        }

        .grand-total {
            margin-top: 32px;
            padding-top: 24px;
            border-top: 2px solid #DDDBDA;
            clear: both;
            display: flex;
            justify-content: flex-end;
            align-items: flex-end;
            gap: 16px;
        }

        .grand-total-label {
            font-size: 12px;
            font-weight: 600;
            color: #706e6b;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .grand-total-value {
            font-size: 32px;
            font-weight: 700;
            color: #0176D3;
        }

        .clearfix::after {
            content: "";
            display: table;
            clear: both;
        }
    </style>
</head>
<body>
    <h1 class="page-title">Data Estimation Calculator</h1>
    
    <div class="modal-card">
        <button class="close-button" onclick="window.close()" aria-label="Close">×</button>
        
        <h2 class="card-title">Data 360 Data Foundation</h2>
        <p class="card-description">The information you enter here has an impact across multiple Data 360 use cases. You will have the opportunity to edit your answers.</p>

        <div class="form-group">
            <div class="form-row">
                <div class="form-group-inline">
                    <label class="question-label question-label-large" for="totalCustomers">
                        How many customers do you have?
                        <span class="info-icon" title="Enter the total number of unique customers in your system">i</span>
                    </label>
                    <input type="text" id="totalCustomers" class="input-field" value="1,000,000" oninput="formatInput(this)" onblur="handleCustomerInput(this)" onfocus="handleCustomerFocus(this)">
                </div>
                <div class="form-group-inline">
                    <label class="question-label question-label-large">
                        How many sources of customer data do you have?
                        <span class="info-icon" title="Number of different data sources you want to include">i</span>
                    </label>
                    <div class="stepper-container">
                        <button class="stepper-button" onclick="changeSourceCount(-1)" aria-label="Decrease">−</button>
                        <input type="text" id="sourceCount" class="stepper-input" value="3" readonly style="text-align: center; font-size: 18px; font-weight: 700; color: #0176D3;">
                        <button class="stepper-button" onclick="changeSourceCount(1)" aria-label="Increase">+</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="sourcesContainer"></div>

        <div id="staticLinesContainer"></div>

        <div class="grand-total">
            <div class="grand-total-label">Total Records</div>
            <div class="grand-total-value" id="grandTotal">0</div>
        </div>

        <button class="action-button" onclick="proceedToUseCases()">Go to Use Cases</button>
        <div class="clearfix"></div>
    </div>

    <script>
        const totalCustomersInput = document.getElementById('totalCustomers');
        const sourceCountInput = document.getElementById('sourceCount');
        const sourcesContainer = document.getElementById('sourcesContainer');
        const staticLinesContainer = document.getElementById('staticLinesContainer');
        const grandTotalElement = document.getElementById('grandTotal');

        let sources = [];
        let customerCount = 1000000;

        function formatNumber(num) {
            return num.toLocaleString();
        }

        function parseFormattedNumber(str) {
            return parseInt(str.replace(/,/g, '')) || 0;
        }

        function formatInput(input) {
            const cursorPos = input.selectionStart;
            const value = input.value.replace(/,/g, '');
            const num = parseInt(value) || 0;
            const formatted = formatNumber(num);
            input.value = formatted;
            
            // Restore cursor position
            const newCursorPos = formatted.length - (input.value.length - cursorPos);
            input.setSelectionRange(newCursorPos, newCursorPos);
        }

        function handleCustomerFocus(input) {
            input.value = input.value.replace(/,/g, '');
        }

        function handleCustomerInput(input) {
            const num = parseFormattedNumber(input.value);
            customerCount = num;
            input.value = formatNumber(num);
            calculateAll();
        }

        function changeSourceCount(val) {
            let current = parseInt(sourceCountInput.value.replace(/,/g, '')) || 3;
            let newVal = Math.max(1, current + val);
            sourceCountInput.value = formatNumber(newVal);
            updateSources();
            calculateAll();
        }

        function updateSources() {
            const count = parseInt(sourceCountInput.value.replace(/,/g, '')) || 3;
            
            // Adjust sources array
            while (sources.length < count) {
                sources.push({
                    name: `Source ${sources.length + 1}`,
                    type: 'records', // 'records' = 5, 'events' = 25
                    multiplier: 1,
                    containsProfiles: false
                });
            }
            while (sources.length > count) {
                sources.pop();
            }
            
            renderSources();
            renderStaticLines();
            calculateAll();
        }

        function renderStaticLines() {
            const customerCountNum = parseFormattedNumber(totalCustomersInput.value);
            
            // Count checked checkboxes
            const checkedCount = sources.filter(s => s.containsProfiles).length;
            const systemProfiles = customerCountNum * checkedCount;
            
            const unifiedProfiles = customerCountNum;
            
            staticLinesContainer.innerHTML = `
                <div class="source-item-static">
                    <div class="source-name-static">Unified Profiles</div>
                    <div class="source-type-static"></div>
                    <div class="source-multiplier"></div>
                    <div class="source-checkbox"></div>
                    <div class="source-result-static" id="unifiedProfiles">${formatNumber(unifiedProfiles)}</div>
                </div>
                <div class="source-item-static">
                    <div class="source-name-static">System Profiles</div>
                    <div class="source-type-static"></div>
                    <div class="source-multiplier"></div>
                    <div class="source-checkbox"></div>
                    <div class="source-result-static" id="systemProfiles">${formatNumber(systemProfiles)}</div>
                </div>
            `;
        }

        function renderSources() {
            sourcesContainer.innerHTML = '';
            
            sources.forEach((source, index) => {
                const sourceDiv = document.createElement('div');
                sourceDiv.className = 'source-item';
                
                const calculatedTotal = customerCount * source.multiplier * (source.type === 'events' ? 25 : 5);
                
                sourceDiv.innerHTML = `
                    <div class="source-name">
                        <input type="text" class="source-name-input" value="${source.name}" 
                               oninput="updateSourceName(${index}, this.value)">
                    </div>
                    <div class="source-type">
                        <div class="radio-column">
                            <div class="radio-column-label">Customer Records</div>
                            <input type="radio" name="type-${index}" class="radio-button" value="records" 
                                   ${source.type === 'records' ? 'checked' : ''} 
                                   onchange="updateSourceType(${index}, 'records')">
                        </div>
                        <div class="radio-column">
                            <div class="radio-column-label">Streaming Events</div>
                            <input type="radio" name="type-${index}" class="radio-button" value="events" 
                                   ${source.type === 'events' ? 'checked' : ''} 
                                   onchange="updateSourceType(${index}, 'events')">
                        </div>
                    </div>
                    <div class="source-multiplier">
                        <div class="source-multiplier-label">Multiplier Value</div>
                        <div class="stepper-container">
                            <button class="stepper-button" onclick="changeSourceMultiplier(${index}, -1)" aria-label="Decrease">−</button>
                            <input type="number" class="stepper-input" id="multiplier-${index}" value="${source.multiplier}" readonly>
                            <button class="stepper-button" onclick="changeSourceMultiplier(${index}, 1)" aria-label="Increase">+</button>
                        </div>
                    </div>
                    <div class="source-checkbox">
                        <input type="checkbox" id="profileCheckbox-${index}" 
                               ${source.containsProfiles ? 'checked' : ''} 
                               onchange="updateContainsProfiles(${index}, this.checked)">
                        <label for="profileCheckbox-${index}" class="source-checkbox-label">Contains Customer Profiles</label>
                    </div>
                    <div class="source-result">
                        <input type="text" class="source-result-input" id="result-${index}" 
                               value="${formatNumber(calculatedTotal)}" 
                               oninput="formatInput(this)" 
                               onblur="handleSourceTotalInput(${index}, this)" 
                               onfocus="handleSourceTotalFocus(this)">
                    </div>
                `;
                sourcesContainer.appendChild(sourceDiv);
            });
        }

        function handleSourceTotalFocus(input) {
            input.value = input.value.replace(/,/g, '');
        }

        function handleSourceTotalInput(index, input) {
            const newTotal = parseFormattedNumber(input.value);
            input.value = formatNumber(newTotal);
            
            // Reverse calculate the multiplier to achieve this total
            const typeMultiplier = sources[index].type === 'events' ? 25 : 5;
            if (customerCount > 0 && typeMultiplier > 0) {
                const newMultiplier = Math.max(1, Math.round(newTotal / (customerCount * typeMultiplier)));
                sources[index].multiplier = newMultiplier;
                
                // Update the multiplier display
                const multiplierInput = document.getElementById(`multiplier-${index}`);
                if (multiplierInput) {
                    multiplierInput.value = newMultiplier;
                }
            }
            
            calculateAll();
        }

        function updateSourceName(index, value) {
            sources[index].name = value;
        }

        function updateSourceType(index, type) {
            sources[index].type = type;
            calculateAll();
        }

        function updateContainsProfiles(index, checked) {
            sources[index].containsProfiles = checked;
            calculateAll();
        }

        function changeSourceMultiplier(index, val) {
            let current = parseInt(sources[index].multiplier);
            let newVal = Math.max(1, current + val);
            sources[index].multiplier = newVal;
            const input = document.getElementById(`multiplier-${index}`);
            if (input) {
                input.value = newVal;
            }
            calculateAll();
        }

        function calculateAll() {
            // Update customer count from input
            customerCount = parseFormattedNumber(totalCustomersInput.value);
            
            // Calculate static lines
            const checkedCount = sources.filter(s => s.containsProfiles).length;
            const unifiedProfiles = customerCount;
            const systemProfiles = customerCount * checkedCount;
            
            // Update static lines display
            const unifiedElement = document.getElementById('unifiedProfiles');
            const systemElement = document.getElementById('systemProfiles');
            if (unifiedElement) unifiedElement.textContent = formatNumber(unifiedProfiles);
            if (systemElement) systemElement.textContent = formatNumber(systemProfiles);
            
            // Calculate source totals
            let sourceTotal = 0;
            sources.forEach((source, index) => {
                const typeMultiplier = source.type === 'events' ? 25 : 5;
                const total = customerCount * source.multiplier * typeMultiplier;
                sourceTotal += total;
                
                const resultElement = document.getElementById(`result-${index}`);
                if (resultElement && document.activeElement !== resultElement) {
                    resultElement.value = formatNumber(total);
                }
            });

            // Grand total includes unified profiles + system profiles + all source totals
            const grandTotal = unifiedProfiles + systemProfiles + sourceTotal;
            grandTotalElement.textContent = formatNumber(grandTotal);
        }

        function proceedToUseCases() {
            alert('Proceeding to use cases...\n\nTotal Customers: ' + totalCustomersInput.value + '\nSources: ' + sources.length + '\nGrand Total: ' + grandTotalElement.textContent);
        }

        // Initialize
        updateSources();
        renderStaticLines();
        calculateAll();
    </script>
</body>
</html>
